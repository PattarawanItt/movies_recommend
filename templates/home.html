<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üé¨ Movie Recommender</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    input, button { padding: 0.5rem; width: 100%; margin-top: 1rem; }
    #chatBox { margin-top: 2rem; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-center mb-4">üé¨ Movie Recommender</h2>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á -->
    <form method="POST" action="/recommend" class="d-flex flex-column aligns-center mb-4">
      <input type="text" name="movie" class="form-control" placeholder="Enter a movie title (e.g. Inception)" required />
      <button type="submit" class="btn btn-primary mt-2">Recommend</button>
    </form>

    <!-- ‡∏ú‡∏•‡∏£‡∏µ‡πÄ‡∏Ñ‡∏ß‡∏™‡∏ï‡πå‡∏´‡∏ô‡∏±‡∏á -->
    {% if recommendations %}
      <h5>Recommended Movies:</h5>
      <ul class="list-group mb-4">
        {% for movie in recommendations %}
          <li class="list-group-item">{{ movie }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡∏≤‡∏° Chatbot -->
    <div class="text-center mb-4">
      <button id="toggleChatBtn" class="btn btn-secondary">üß† ‡∏ñ‡∏≤‡∏° Chatbot</button>
    </div>

    <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ -->
    <div id="chatBox" class="card p-3 d-none">
      <input type="text" id="chatInput" class="form-control" placeholder="‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á..." />
      <button onclick="askChat()" class="btn btn-outline-success mt-2">‡∏ñ‡∏≤‡∏°‡πÄ‡∏•‡∏¢</button>
      <div class="mt-3" id="chatResponse"></div>
    </div>
  </div>

  <script>
    // ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ä‡∏ó
    document.getElementById('toggleChatBtn').addEventListener('click', () => {
      document.getElementById('chatBox').classList.toggle('d-none');
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    async function askChat() {
      const inputEl = document.getElementById('chatInput');
      const responseDiv = document.getElementById('chatResponse');
      const message = inputEl.value.trim();

      if (!message) return;

      responseDiv.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏≤‡∏° AI...";
      
      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: message, language: 'th' }),
        });
        const data = await res.json();

        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
        if (data.recommendations && data.recommendations.length > 0) {
          const recList = data.recommendations.map(m => `<li>${m}</li>`).join('');
          responseDiv.innerHTML += `<br/><strong>üé• ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong><ul>${recList}</ul>`;
        }
      } catch (err) {
        responseDiv.innerHTML = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
        console.error(err);
      }
    }
  </script>
</body>
</html>